<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>基于java getter/setter方法配置apache shiro</title>

	<link rel="shortcut icon" href="/styles/images/favicon.jpg">
	<link rel="icon" href="/styles/images/favicon.jpg">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="/2016/08/28/%E4%BD%BF%E7%94%A8-java-getter.setter%E6%96%B9%E6%B3%95%E9%85%8D%E7%BD%AEapache-shiro/">
	<link rel="alternate" type="application/rss+xml" title="阳光如初." href="/feed.xml">

	<meta name="description" content="阳光如初;sunshineasbefore;个人博客;怀揣梦想,永不止步;">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0];
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>


  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.jpg">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="/">主页</a>
        </li>
        <li>
          <a href="/categories/">分类</a>
        </li>
        <li>
          <a href="/tag">标签</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="https://github.com/sunshineasbefore">Github</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>基于java getter/setter方法配置apache shiro</h1>
		    <p>Post on Aug 28, 2016 by <a href="/about">sunshineasbefore</a></p>
		-->
		    <h3>怀揣梦想,永不止步!</h3>
    
  </div>
</div>

    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#Apache-Shiro-ref">Apache-Shiro</a>	/
    	<a href="/tag/#shiro-ref">shiro</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2016">2016</a>
          <ul class="nav">
            <li><a href="#month_2016_October">October</a></li>
      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_September">September</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_August">August</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div> 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">基于java getter/setter方法配置apache shiro</h1>
              <!--
                <p class="post-meta">Aug 28, 2016</p>
              -->
              <div class="meta">Posted on <span class="postdate">Aug 28, 2016</span> By <a target="_blank" href="http://www.veryjava.cn">sunshineasbefore</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">说明</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">代码</a></li>
</ul>

<p>本文主要介绍使用javaconfig的模式配置Shiro web.</p>

<h1 id="section">说明</h1>

<ul>
  <li>谷歌,百度上介绍apache shiro配置的文章并不少,但是缺少我想要的基于java getter/setter方法配置apache shiro的文章.今天整一个.</li>
  <li>重点在于 ShiroConfig类中如何配置shiroFilter,securityManager,tokenRealm,sessionListener以及sessionManager.</li>
  <li><code class="highlighter-rouge">@Configuration</code>是spring的一个注解,用来标识该类是一个配置类,并且会注入到spring容器中.可以直接使用@Autowird注入.</li>
</ul>

<h1 id="section-1">代码</h1>
<p>SessionListener:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import org.apache.shiro.session.Session;
import org.springframework.stereotype.Component;
import ss.app.common.util.ContextUtil;

@Component
public class SessionListener implements org.apache.shiro.session.SessionListener {

  @Override
  public void onStart(Session session) {
  }

  @Override
  public void onStop(Session session) {
  }

  @Override
  public void onExpiration(Session session) {
  }
}
</code></pre>
</div>

<p>UserRealm:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import org.apache.commons.lang3.StringUtils;
import org.apache.shiro.authc.*;
import org.apache.shiro.authz.AuthorizationInfo;
import org.apache.shiro.realm.AuthorizingRealm;
import org.apache.shiro.subject.PrincipalCollection;
import org.springframework.beans.factory.annotation.Autowired;
import ss.app.user.entity.SystemUser;
import ss.app.user.service.SystemUserService;

public class UserRealm extends AuthorizingRealm {

  @Autowired
  private SystemUserService systemUserService;

  @Override
  protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) {
    return null;
  }

  @Override
  protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException {
    String name = (String) token.getPrincipal();
    String password = String.valueOf((char[]) token.getCredentials());

    if (StringUtils.isBlank("name") || StringUtils.isBlank("password")) {
      throw new UnknownAccountException("用户名或者密码为空");
    }

    SystemUser user = systemUserService.findByName(name);

    if (null == user) {
      throw new UnknownAccountException("用户不存在");
    }

    if (!StringUtils.equals(password, user.getPassword())) {
      throw new UnknownAccountException("密码不正确");
    }

    //如果身份认证验证成功，返回一个AuthenticationInfo实现
    return new SimpleAuthenticationInfo(name, password, getName());
  }
}
</code></pre>
</div>

<p>ShiroConfig:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import org.apache.shiro.realm.Realm;
import org.apache.shiro.session.SessionListener;
import org.apache.shiro.session.mgt.SessionManager;
import org.apache.shiro.spring.web.ShiroFilterFactoryBean;
import org.apache.shiro.web.filter.authc.UserFilter;
import org.apache.shiro.web.mgt.DefaultWebSecurityManager;
import org.apache.shiro.web.session.mgt.DefaultWebSessionManager;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.servlet.Filter;
import java.util.*;

@Configuration
public class ShiroConfig {

  @Bean(name = "shiroFilter")
  public ShiroFilterFactoryBean shiroFilter() {
    ShiroFilterFactoryBean shiroFilter = new ShiroFilterFactoryBean();
    shiroFilter.setLoginUrl("/");
    shiroFilter.setSuccessUrl("/index");
    shiroFilter.setUnauthorizedUrl("/forbidden");

    Map&lt;String, Filter&gt; filters = new HashMap&lt;&gt;();
    filters.put("users", new UserFilter());
    shiroFilter.setFilters(filters);

    Map&lt;String, String&gt; filterChainMap = new HashMap&lt;&gt;();
    filterChainMap.put("/index/**", "users");
    filterChainMap.put("/menu/**", "users");
    filterChainMap.put("/gzhyy/**", "users");
    filterChainMap.put("/gzhgl/**", "users");
    filterChainMap.put("/assert/**", "anon");
    filterChainMap.put("/css/**", "anon");
    filterChainMap.put("/js/**", "anon");
    shiroFilter.setFilterChainDefinitionMap(filterChainMap);
    shiroFilter.setSecurityManager(securityManager());

    return shiroFilter;
  }

  public org.apache.shiro.mgt.SecurityManager securityManager() {
    DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();
    securityManager.setSessionManager(sessionManager());
    Collection&lt;Realm&gt; realms = new ArrayList&lt;&gt;();
    realms.add(tokenRealm());
    securityManager.setRealms(realms);
    return securityManager;
  }

  @Bean
  public UserRealm tokenRealm() {
    return new UserRealm();
  }

  public List&lt;SessionListener&gt; sessionListener() {
    List&lt;SessionListener&gt; listeners = new ArrayList&lt;&gt;();
    listeners.add(new ss.app.common.config.session.SessionListener());
    return listeners;
  }

  public SessionManager sessionManager() {
    DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();
    sessionManager.setSessionListeners(sessionListener());
    sessionManager.setGlobalSessionTimeout(30 * 60　* 1000); // 30分钟
    return sessionManager;
  }
}
</code></pre>
</div>

            </article>
        </div>
      </div>
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            


  <div class="ds-thread" data-thread-key="/2016/08/28/%E4%BD%BF%E7%94%A8-java-getter.setter%E6%96%B9%E6%B3%95%E9%85%8D%E7%BD%AEapache-shiro/" data-title="基于java getter/setter方法配置apache shiro" data-url="http://www.veryjava.cn/2016/08/28/%E4%BD%BF%E7%94%A8-java-getter.setter%E6%96%B9%E6%B3%95%E9%85%8D%E7%BD%AEapache-shiro/"></div>

<script type="text/javascript">
var duoshuoQuery = {short_name:"ssab"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


 
          </div>
        </article>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2014-2016 <a href=""><code>sunshineasbefore</code></a>.</p>
		<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme from <a href="http://lesscss.cn/">Less</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/application.js"></script>
<script src="/styles/js/lessismore.js"></script>

  </body>
</html>
